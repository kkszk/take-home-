# BTC Market Making & RL Hedging Strategy
本项目基于强化学习（RL）技术，构建了一套完整的 BTC 永续合约做市与期权动态对冲系统。系统通过 QED 扩散 + Hawkes 跳跃模型模拟真实 BTC 价格波动，在基础做市策略上叠加期权对冲层，并利用 RL 智能体学习最优对冲策略，最终实现风险可控下的长期收益最大化。
## 项目结构
```
├── 01_data_and_stylized_facts.ipynb  # 数据探索与典型事实分析
├── 02_btc_simulator_qed_hawkes.ipynb # BTC 价格模拟器实现与验证
├── 03_option_market_layer.ipynb     # 期权市场层（IV 曲面 + BS 定价）
├── 04_baseline_mm_strategy.ipynb    # 基准做市策略模拟
├── 05_rl_hedging_environment.ipynb  # RL 对冲环境（MDP 框架）
├── 06_rl_training_results.ipynb     # RL 智能体训练与结果分析
├── 07_rl_vs_baseline_evaluation.ipynb # RL 与基准策略对比评估
├── src/                             # 核心代码模块
│   ├── simulator.py                 # QED + Hawkes 价格模拟器
│   ├── option_surface.py            # IV 曲面构建与 BS 定价
│   ├── mm_strategy.py               # 做市策略逻辑
│   ├── rl_env.py                    # RL 环境（符合 Gym 接口）
│   ├── rl_agent.py                  # DQN RL 智能体
│   └── utils.py                     # 工具函数（绘图、指标计算）
├── data/                            # 数据目录
│   ├── simulated_btc_paths.csv      # BTC永续合约数据
│   └── ppo_hedging_simple.zip       # 运行过程中生成的中间数据
├── requirements.txt                 # 依赖库清单
└── README.md                        # 项目说明文档
```
## 环境配置
使用python3.11及以上版本并且安装相关依赖
```
conda create -n p311 python=3.11
pip install -r requirements.txt
```


## 核心功能模块说明
### 1. BTC 价格模拟器（`src/simulator.py`）
基于**QED 扩散过程**与**Hawkes 跳跃过程**的组合模型，精准复现 BTC 价格的典型事实（胖尾分布、波动率聚集、跳跃集群性）：
- **QED 扩散**：非线性均值回归过程，捕捉波动率聚集与胖尾特性；
- **Hawkes 跳跃**：自激发跳跃过程，模拟市场对重大事件的集群式反应；
- 输出：5 分钟频率价格路径、收益率、波动率及跳跃标记。

### 2. 期权市场层（`src/option_surface.py`）
构建符合真实市场特性的期权定价体系：
- **IV 曲面**：基于到期时间（1d/3d/7d/14d/1m）、虚值程度（0.9S₀/S₀/1.1S₀）及本地波动率动态调整；
- **布莱克-斯科尔斯定价**：支持认购/认沽期权定价，考虑市场状态（平静/波动）对 IV 的影响；
- 交易成本：固定 0.05% 名义价值的期权交易手续费（符合真实市场水平）。

### 3. 基准做市策略（`src/mm_strategy.py`）
简化版 BTC 永续合约做市逻辑，核心机制包括：
- **报价调整**：基于当前库存（`φₙ = Iₙ/Iₘₐₓ`）动态调整买卖价差，避免单向风险累积；
- **库存控制**：库存超限时触发“强制去库存”开关，仅挂单反向交易；
- **风险限制**：严格控制库存绝对值（`|Iₙ| ≤ Iₘₐₓ`）与最低权益（`Πₙ ≥ Πₘᵢₙ`）。

### 4. RL 对冲系统（`src/rl_env.py` + `src/rl_agent.py`）
#### 4.1 MDP 环境设计
| 组件         | 具体定义                                                                 |
|--------------|--------------------------------------------------------------------------|
| **状态空间** | `(Sₙ, Iₙ, Hₙ, Vₙ, σ̂ₗₒc, TTM, moneyness, ΔSₙ, ΔVₙ)`（文档规定 9 维状态）     |
| **动作空间** | 30 种期权交易动作（3 行权价×5 到期日×2 期权类型）+1 种“无动作”                |
| **奖励函数** | 总权益变化 - 期权交易成本 - 风险惩罚（`(Iₙ + HₙΔₙ)²`）                   |
| **转移函数** | 基于 BTC 价格模拟器、做市策略与期权定价模型的联合动态                       |

#### 4.2 DQN 智能体
- 网络结构：3 层全连接网络（输入层 128 维→隐藏层 64 维→输出层 31 维）；
- 训练机制：经验回放、目标网络延迟更新（每 100 步同步）、ε-贪婪探索（ε 从 1.0 衰减至 0.01）；
- 优化目标：最大化长期、扣除成本后的权益质量，同时控制库存与对冲风险。

## 注意事项
notebooks目录中的ipynb文件也可以直接执行，实现该项目的全部功能。

